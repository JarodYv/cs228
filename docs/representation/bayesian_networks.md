# 贝叶斯网络

我们先从*表示*这一主题开始：我们如何选择概率分布来模拟真实世界中我们感兴趣的方面？
提出一个好的模型并不容易：我们在导言中看到，一个简单的垃圾邮件分类模型需要我们指定一系列参数，这些参数随着英语单词数呈指数级增长！

本章中，我们将学习一种避免此类复杂情况的方法。我们将：

- 学习一种仅使用少量参数参数化概率分布的有效且通用的技术。
- 考察如何通过有*向无环图*（DAG）优雅地描述结果模型。
- 研究DAG的结构与其描述分布做出的建模假设之间的联系；这不仅会使这些建模假设更加明确，还将帮助我们设计更高效的推理算法。

我们这里用到的模型被称为*贝叶斯网络*。下一章我们将看到第二种方法--*马尔可夫随机场*（MRF），重要作用于*无向图*。
贝叶斯网络有效地反映了因果关系，而马尔可夫随机场不能。因此，对于随机变量之间没有明确因果关系的问题，马尔可夫随机场更适用。

## 贝叶斯网络概率模型

有向图模型（又称贝叶斯网络）是一类概率分布，它让有向图可以自然地描述紧凑参数化。

这种参数化背后的一般思想非常简单。

回想一下链式法则，我们可以将任何概率$p$写成：

$$
p(x_1, x_2, \dotsc, x_n) = p(x_1) p(x_2 \mid x_1) \cdots p(x_n \mid x_{n-1}, \dotsc, x_2, x_1)
$$

紧凑贝叶斯网络是一种分布，其右侧的每个因子仅依赖于少量祖先变量 $x_{A_i}$:

$$ p(x_i \mid x_{i-1}, \dotsc, x_1) = p(x_i \mid x_{A_i})$$

例如，在一个具有5个变量的模型中，我们可以选择用 $p(x_5 \mid x_4, x_3)$ 近似表示因子 $p(x_5 \mid x_4, x_3, x_2, x_1)$。
这个例子中，我们写做 $x_{A_5} = \{x_4, x_3\}$。

当变量是离散变量时（我们要考虑的问题中通常是这种情况），我们可以将因子 $p(x_i\mid x_{A_i})$ 视为*概率表*，
其中行对应于 $x_{A_i}$ 的赋值，列对应于 $x_i$ 的值；每一项包含实际概率 $p(x_i\mid x_{A_i})$。
如果每个变量取 $d$ 个取值，并且最多有 $k$ 个祖先，则整个表最多将包含 $O(d^{k+1})$ 个项。
由于每个变量对应一个表，所以完整地概率分布仅需要 $O(nd^{k+1})$ 个参数就可以紧凑地（相比于$O(d^n)$这种朴素的方法）描述。

### 图表示

这种形式的分布可以自然地表示为*有向无环图*，其中顶点对应于变量$x_i$，边表示依赖关系。特别是，我们将每个节点 $x_i$ 的父节点设为其祖先 $x_{A_i}$。

举个例子，考虑一个学生考试成绩 $g$ 的模型。考试成绩依赖于考试难度 $d$ 和学生智力 $i$，同时还影响授课老师的推荐信质量 $l$。
学生智力 $i$ 还影响SAT分数 $s$。除了变量 $g$ 有3个取值，其他变量都只有2个取值。5个变量的联合概率分布自然分解如下：

$$ p(l, g, i, d, s) = p(l \mid g)\, p(g \mid i, d)\, p(i)\, p(d)\, p(s \mid i). $$

![](../_media/img/grade-model.png)

<small>描述学生考试成绩的贝叶斯网络模型。其分布可以用表中给定的条件概率分布的乘积表示。</small>

这个分布的图形表示是一个有向无环图（DAG），它直观地指明了随机变量之间的相互依赖关系。
图清楚地表明，推荐信取决于成绩，而成绩又取决于学生的智力和考试难度。

另一种解释有向图的方法是数据是如何生成的过程。在上面的例子中，为了确定推荐信的质量，我们可以首先抽样调查智力水平和考试难度；
然后，给定这些参数，对学生的成绩进行抽样；最后，根据该等级生成推荐信。

在前面的垃圾邮件分类例子中，我们隐式假设电子邮件是根据两步过程生成的：首先，我们选择垃圾邮件/非垃圾邮件标签 $y$；
然后，我们分别采样每个单词是否存在于该标签。

### 正式定义

形式地讲，贝叶斯网络是一个有向图 $G = (V,E)$，与

- 每个节点 $i \in V$ 对应一个随机变量 $x_i$；
- 每个节点具有一个条件概率分布（CPD）$p(x_i \mid x_{A_i})$，表明 $x_i$ 的概率取决于它的父节点的值。

因此，贝叶斯网络定义了概率分布$p$。相反，我们可以说，如果一个概率 $p$ 可以分解为图 $G$ 中因子的乘积，那么它就是DAG $G$ 的*因子分解*。

不难发现贝叶斯网络表示的概率是有效的：显然，它是非负的，并可用归纳法（并使用CPD是有效概率这一事实）证明所有变量赋值的和为1。
相反，我们也可以通过反证法证明，当$G$包含循环时，其相关概率之和可能不等于1。

## 贝叶斯网络的依赖

### 用有向图描述独立性

### 有向图的表示能力

